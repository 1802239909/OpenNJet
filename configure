#!/bin/sh

# Copyright (C) Igor Sysoev
# Copyright (C) Nginx, Inc.


LC_ALL=C
export LC_ALL

. auto/options
. auto/init
. auto/sources

test -d $NJET_OBJS || mkdir -p $NJET_OBJS

echo > $NJET_AUTO_HEADERS_H
echo > $NJET_AUTOCONF_ERR

echo "#define NJET_CONFIGURE \"$NJET_CONFIGURE\"" > $NJET_AUTO_CONFIG_H


if [ $NJET_DEBUG = YES ]; then
    have=NJET_DEBUG . auto/have
fi


if test -z "$NJET_PLATFORM"; then
    echo "checking for OS"

    NJET_SYSTEM=`uname -s 2>/dev/null`
    NJET_RELEASE=`uname -r 2>/dev/null`
    NJET_MACHINE=`uname -m 2>/dev/null`

    echo " + $NJET_SYSTEM $NJET_RELEASE $NJET_MACHINE"

    NJET_PLATFORM="$NJET_SYSTEM:$NJET_RELEASE:$NJET_MACHINE";

    case "$NJET_SYSTEM" in
        MINGW32_* | MINGW64_* | MSYS_*)
            NJET_PLATFORM=win32
        ;;
    esac

else
    echo "building for $NJET_PLATFORM"
    NJET_SYSTEM=$NJET_PLATFORM
fi

. auto/cc/conf

if [ "$NJET_PLATFORM" != win32 ]; then
    . auto/headers
fi

. auto/os/conf

if [ "$NJET_PLATFORM" != win32 ]; then
    . auto/unix
fi

. auto/threads
. auto/modules
. auto/lib/conf

case ".$NJET_PREFIX" in
    .)
        NJET_PREFIX=${NJET_PREFIX:-/usr/local/njet}
        have=NJET_PREFIX value="\"$NJET_PREFIX/\"" . auto/define
    ;;

    .!)
        NJET_PREFIX=
    ;;

    *)
        have=NJET_PREFIX value="\"$NJET_PREFIX/\"" . auto/define
    ;;
esac

if [ ".$NJET_CONF_PREFIX" != "." ]; then
    have=NJET_CONF_PREFIX value="\"$NJET_CONF_PREFIX/\"" . auto/define
fi

have=NJET_SBIN_PATH value="\"$NJET_SBIN_PATH\"" . auto/define
have=NJET_CONF_PATH value="\"$NJET_CONF_PATH\"" . auto/define
have=NJET_PID_PATH value="\"$NJET_PID_PATH\"" . auto/define
have=NJET_LOCK_PATH value="\"$NJET_LOCK_PATH\"" . auto/define
have=NJET_ERROR_LOG_PATH value="\"$NJET_ERROR_LOG_PATH\"" . auto/define

if [ ".$NJET_ERROR_LOG_PATH" = "." ]; then
    have=NJET_ERROR_LOG_STDERR . auto/have
fi

have=NJET_HTTP_LOG_PATH value="\"$NJET_HTTP_LOG_PATH\"" . auto/define
have=NJET_HTTP_CLIENT_TEMP_PATH value="\"$NJET_HTTP_CLIENT_TEMP_PATH\""
. auto/define
have=NJET_HTTP_PROXY_TEMP_PATH value="\"$NJET_HTTP_PROXY_TEMP_PATH\""
. auto/define
have=NJET_HTTP_FASTCGI_TEMP_PATH value="\"$NJET_HTTP_FASTCGI_TEMP_PATH\""
. auto/define
have=NJET_HTTP_UWSGI_TEMP_PATH value="\"$NJET_HTTP_UWSGI_TEMP_PATH\""
. auto/define
have=NJET_HTTP_SCGI_TEMP_PATH value="\"$NJET_HTTP_SCGI_TEMP_PATH\""
. auto/define

. auto/make
. auto/lib/make
. auto/install

# STUB
. auto/stubs

have=NJET_USER value="\"$NJET_USER\"" . auto/define
have=NJET_GROUP value="\"$NJET_GROUP\"" . auto/define

if [ ".$NJET_BUILD" != "." ]; then
    have=NJET_BUILD value="\"$NJET_BUILD\"" . auto/define
fi

. auto/summary
